
<!DOCTYPE html>

<html lang="it">
<head>
<link href="assets/img/common/plane-logo.png" rel="icon" type="image/png"/>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Pannello admin affiliati – Travirae</title>
<meta content="Pannello admin per monitorare vendite, commissioni nette, payout affiliati e margine Travirae aggregato per mese e per affiliato." name="description"/>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
<link href="assets/css/style.css" rel="stylesheet"/>
</head>
<body class="page--affiliate-admin">
<header class="site-header">
<div class="container header-inner">
<a class="brand" href="index.html">
<img alt="Travirae" src="assets/img/common/plane-logo.png"/>
<span>TRAVIRAE</span>
</a>
<nav aria-label="Navigazione principale" class="main-nav">
<a class="nav-link" href="index.html">Hotel</a>
<a class="nav-link" href="flights.html">Voli</a>
<a class="nav-link" href="programma-affiliato.html">Programma affiliato</a>
</nav>
<button aria-expanded="false" aria-label="Apri menu" class="nav-toggle"><span></span><span></span><span></span></button>
</div>
</header>

<main>
<section class="section">
<div class="container">
  <div class="auth-card">
    <div class="admin-header">
      <h1 id="admin-title" style="font-size:1.3rem;margin:0 0 4px;">Dashboard admin affiliati</h1>
      <p id="admin-subtitle" class="muted small" style="margin:0;">Accedi con l'account admin per vedere le statistiche globali del programma affiliati.</p>
    </div>

    <div id="admin-view-login">
      <form id="admin-login-form" class="auth-form" autocomplete="on">
        <div class="form-group">
          <label for="admin-email">Email admin</label>
          <input id="admin-email" name="email" type="email" required/>
        </div>
        <div class="form-group">
          <label for="admin-password">Password</label>
          <input id="admin-password" name="password" type="password" required/>
        </div>
        <div class="auth-actions">
          <button type="submit" class="btn">Accedi</button>
        </div>
      </form>
    </div>

    <div id="admin-view-dashboard" hidden>
      <div class="admin-stats-grid">
        <div class="stat-card">
          <div class="stat-label">Vendite valide (mese corrente)</div>
          <div class="stat-value" id="admin-total-sales">—</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Commissioni nette (mese corrente)</div>
          <div class="stat-value" id="admin-total-net">—</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Payout affiliati (mese corrente)</div>
          <div class="stat-value" id="admin-total-aff">—</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Margine Travirae (mese corrente)</div>
          <div class="stat-value" id="admin-total-trav">—</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Vendite dirette (senza affiliato)</div>
          <div class="stat-value" id="admin-direct-sales">—</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Commissioni dirette (senza affiliato)</div>
          <div class="stat-value" id="admin-direct-net">—</div>
        </div>
      </div>

      <h2 class="admin-section-title">Traffico sito (mese corrente)</h2>
      <div class="admin-stats-grid">
        <div class="stat-card">
          <div class="stat-label">Visite totali</div>
          <div class="stat-value" id="admin-traffic-visits">—</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Pageview totali</div>
          <div class="stat-value" id="admin-traffic-pageviews">—</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Visite da affiliati</div>
          <div class="stat-value" id="admin-traffic-visits-affiliate">—</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Visite dirette</div>
          <div class="stat-value" id="admin-traffic-visits-direct">—</div>
        </div>
      </div>

      <div class="admin-note" style="margin-top:10px;">
        <span class="muted small">Le “visite” sono sessioni (session_id) uniche; i “pageview” sono caricamenti pagina registrati dal sito. I dati includono traffico con e senza parametro <code>?ref=</code>.</span>
      </div>

      <h2 class="admin-section-title" style="margin-top:18px;">Booking click sito (mese corrente)</h2>
      <div class="admin-stats-grid">
        <div class="stat-card">
          <div class="stat-label">Booking click totali</div>
          <div class="stat-value" id="admin-bclick-total">—</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Booking click da affiliati</div>
          <div class="stat-value" id="admin-bclick-affiliate">—</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Booking click diretti (senza affiliato)</div>
          <div class="stat-value" id="admin-bclick-direct">—</div>
        </div>
      </div>

      <div class="admin-note" style="margin-top:10px;">
        <span class="muted small">I “booking click” sono i click dentro i widget (Stay22 / Aviasales) che portano l’utente fuori dal sito. <strong>Non sono</strong> vendite confermate.</span>
      </div>

      <div class="admin-actions">
        <button type="button" class="btn secondary" id="admin-reload-btn">Ricarica dati</button>
        <button type="button" class="btn secondary" id="admin-import-aviasales-btn">Importa vendite Aviasales</button>
        <button type="button" class="btn secondary" id="admin-import-stay22-csv-btn">Importa Stay22 CSV</button>
        <input type="file" id="admin-stay22-csv-input" accept=".csv,text/csv" hidden/>
        <button type="button" class="btn secondary" id="admin-refresh-payouts-btn">Aggiorna payouts</button>
        <button type="button" class="btn secondary" id="admin-2fa-btn">Sicurezza (2FA)</button>
        <button type="button" class="btn" id="admin-logout-btn">Esci</button>
      </div>

      <details class="admin-accordion" id="admin-newsletter-accordion">
      <summary class="admin-section-title admin-accordion-summary">Newsletter</summary>

            <div class="admin-stats-grid" style="margin-top: 10px;">
        <div class="stat-card">
          <div class="stat-label">Iscritti newsletter (totale)</div>
          <div id="admin-newsletter-count" class="stat-value">—</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Iscritti ITA</div>
          <div id="admin-newsletter-count-ITA" class="stat-value">—</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Iscritti ENG</div>
          <div id="admin-newsletter-count-ENG" class="stat-value">—</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Iscritti ARA</div>
          <div id="admin-newsletter-count-ARA" class="stat-value">—</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Iscritti DEU</div>
          <div id="admin-newsletter-count-DEU" class="stat-value">—</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Iscritti SPA</div>
          <div id="admin-newsletter-count-SPA" class="stat-value">—</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Iscritti RUS</div>
          <div id="admin-newsletter-count-RUS" class="stat-value">—</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Iscritti NLD</div>
          <div id="admin-newsletter-count-NLD" class="stat-value">—</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Iscritti ZHO</div>
          <div id="admin-newsletter-count-ZHO" class="stat-value">—</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Iscritti FRA</div>
          <div id="admin-newsletter-count-FRA" class="stat-value">—</div>
        </div>
      </div>


      <div class="admin-card" style="margin-top: 12px;">
        <form id="admin-newsletter-form" class="admin-newsletter-form">
          <p class="muted small" style="margin: 0 0 12px;">
            Compila <strong>almeno ITA</strong> (oggetto e testo). Se una lingua è vuota verrà usato ITA come fallback.
            La newsletter verrà inviata nella lingua salvata al momento dell’iscrizione (es. se l’utente si iscrive con il sito su ENG, riceverà la newsletter in ENG).
          </p>

          <div class="admin-newsletter-grid">
            <div class="admin-newsletter-lang" data-lang="ITA">
              <div class="admin-newsletter-lang-head"><span class="code">ITA</span><span class="name">Italiano</span></div>
              <label for="newsletter-subject-ITA">Oggetto</label>
              <input id="newsletter-subject-ITA" type="text" placeholder="Oggetto (ITA)" autocomplete="off" />
              <label for="newsletter-body-ITA">Testo</label>
              <textarea id="newsletter-body-ITA" rows="6" placeholder="Testo newsletter (ITA)"></textarea>
            </div>

            <div class="admin-newsletter-lang" data-lang="ENG">
              <div class="admin-newsletter-lang-head"><span class="code">ENG</span><span class="name">English</span></div>
              <label for="newsletter-subject-ENG">Subject</label>
              <input id="newsletter-subject-ENG" type="text" placeholder="Subject (ENG)" autocomplete="off" />
              <label for="newsletter-body-ENG">Body</label>
              <textarea id="newsletter-body-ENG" rows="6" placeholder="Newsletter body (ENG)"></textarea>
            </div>

            <div class="admin-newsletter-lang" data-lang="FRA">
              <div class="admin-newsletter-lang-head"><span class="code">FRA</span><span class="name">Français</span></div>
              <label for="newsletter-subject-FRA">Objet</label>
              <input id="newsletter-subject-FRA" type="text" placeholder="Objet (FRA)" autocomplete="off" />
              <label for="newsletter-body-FRA">Texte</label>
              <textarea id="newsletter-body-FRA" rows="6" placeholder="Texte newsletter (FRA)"></textarea>
            </div>

            <div class="admin-newsletter-lang" data-lang="DEU">
              <div class="admin-newsletter-lang-head"><span class="code">DEU</span><span class="name">Deutsch</span></div>
              <label for="newsletter-subject-DEU">Betreff</label>
              <input id="newsletter-subject-DEU" type="text" placeholder="Betreff (DEU)" autocomplete="off" />
              <label for="newsletter-body-DEU">Text</label>
              <textarea id="newsletter-body-DEU" rows="6" placeholder="Newsletter-Text (DEU)"></textarea>
            </div>

            <div class="admin-newsletter-lang" data-lang="SPA">
              <div class="admin-newsletter-lang-head"><span class="code">SPA</span><span class="name">Español</span></div>
              <label for="newsletter-subject-SPA">Asunto</label>
              <input id="newsletter-subject-SPA" type="text" placeholder="Asunto (SPA)" autocomplete="off" />
              <label for="newsletter-body-SPA">Texto</label>
              <textarea id="newsletter-body-SPA" rows="6" placeholder="Texto newsletter (SPA)"></textarea>
            </div>

            <div class="admin-newsletter-lang" data-lang="NLD">
              <div class="admin-newsletter-lang-head"><span class="code">NLD</span><span class="name">Nederlands</span></div>
              <label for="newsletter-subject-NLD">Onderwerp</label>
              <input id="newsletter-subject-NLD" type="text" placeholder="Onderwerp (NLD)" autocomplete="off" />
              <label for="newsletter-body-NLD">Tekst</label>
              <textarea id="newsletter-body-NLD" rows="6" placeholder="Nieuwsbrieftekst (NLD)"></textarea>
            </div>

            <div class="admin-newsletter-lang" data-lang="RUS">
              <div class="admin-newsletter-lang-head"><span class="code">RUS</span><span class="name">Русский</span></div>
              <label for="newsletter-subject-RUS">Тема</label>
              <input id="newsletter-subject-RUS" type="text" placeholder="Тема (RUS)" autocomplete="off" />
              <label for="newsletter-body-RUS">Текст</label>
              <textarea id="newsletter-body-RUS" rows="6" placeholder="Текст рассылки (RUS)"></textarea>
            </div>

            <div class="admin-newsletter-lang" data-lang="ARA">
              <div class="admin-newsletter-lang-head"><span class="code">ARA</span><span class="name">العربية</span></div>
              <label for="newsletter-subject-ARA">الموضوع</label>
              <input id="newsletter-subject-ARA" type="text" placeholder="الموضوع (ARA)" autocomplete="off" />
              <label for="newsletter-body-ARA">النص</label>
              <textarea id="newsletter-body-ARA" rows="6" placeholder="نص النشرة (ARA)"></textarea>
            </div>

            <div class="admin-newsletter-lang" data-lang="ZHO">
              <div class="admin-newsletter-lang-head"><span class="code">ZHO</span><span class="name">中文</span></div>
              <label for="newsletter-subject-ZHO">主题</label>
              <input id="newsletter-subject-ZHO" type="text" placeholder="主题 (ZHO)" autocomplete="off" />
              <label for="newsletter-body-ZHO">正文</label>
              <textarea id="newsletter-body-ZHO" rows="6" placeholder="通讯内容 (ZHO)"></textarea>
            </div>
          </div>

          <div class="admin-actions" style="justify-content:flex-end; margin-top: 12px;">
            <button type="submit" class="btn btn-primary" id="admin-newsletter-send-btn">Invia newsletter</button>
          </div>

          <div id="admin-newsletter-status" class="admin-message" style="display:none; margin-top: 10px;"></div>
        </form>
      </div>

    </details>

      <h2 class="admin-section-title">Andamento mensile (aggregato)</h2>
      <div class="admin-table-wrapper">
        <table class="admin-table">
          <thead>
            <tr>
              <th>Mese</th>
              <th>Vendite</th>
              <th>Commissioni nette</th>
              <th>Payout affiliati</th>
              <th>Margine Travirae</th>
            </tr>
          </thead>
          <tbody id="admin-monthly-tbody">
            <tr><td colspan="5" class="muted small">Nessun dato disponibile.</td></tr>
          </tbody>
        </table>
      </div>

      <h2 class="admin-section-title">Riepilogo per affiliato</h2>
      <div class="admin-table-wrapper">
        <table class="admin-table">
          <thead>
            <tr>
              <th>Affiliate ID</th>
              <th>Vendite</th>
              <th>Commissioni nette</th>
              <th>Payout affiliati</th>
              <th>Margine Travirae</th>
            </tr>
          </thead>
          <tbody id="admin-affiliates-tbody">
            <tr><td colspan="5" class="muted small">Nessun dato disponibile.</td></tr>
          </tbody>
        </table>
      </div>

      <h2 class="admin-section-title">Operativo (click e booking click)</h2>
      <p class="muted small" style="margin-top:-4px;">“Booking click” = click dentro i widget (Stay22 / Aviasales) che porta l’utente fuori dal sito. Non è una vendita confermata.</p>
      <div class="admin-table-wrapper">
        <table class="admin-table">
          <thead>
            <tr>
              <th>Affiliate ID</th>
              <th>Email</th>
              <th>Click link</th>
              <th>Booking click tot.</th>
              <th>Booking click Aviasales</th>
              <th>Booking click Stay22</th>
              <th>Vendite confermate (mese)</th>
              <th>Revenue share (mese)</th>
              <th>Guadagno mese</th>
              <th>Saldo disponibile</th>
              <th>Richieste in attesa</th>
              <th>Ultima attività</th>
            </tr>
          </thead>
          <tbody id="admin-affiliates-kpi-tbody">
            <tr><td colspan="12" class="muted small">Nessun dato disponibile.</td></tr>
          </tbody>
        </table>
      </div>

      <h2 class="admin-section-title">Richieste pagamento</h2>
      <div class="admin-table-wrapper">
        <table class="admin-table">
          <thead>
            <tr>
              <th>Data</th>
              <th>Affiliate</th>
              <th>Importo (USD)</th>
              <th>Metodo</th>
              <th>Stato</th>
              <th>Dettagli</th>
              <th>Azioni</th>
            </tr>
          </thead>
          <tbody id="admin-payout-requests-tbody">
            <tr><td colspan="7" class="muted small">Nessuna richiesta pagamento.</td></tr>
          </tbody>
        </table>
      </div>

</div>

      <div style="margin-top:18px;">
        <h2 class="admin-section-title">Grafico (affiliati vs Travirae)</h2>
        <div style="height:260px;">
          <canvas id="admin-earnings-chart" aria-label="Grafico guadagni affiliati vs Travirae"></canvas>
        </div>
      </div>
    </div>

    <div id="admin-message" class="admin-message" aria-live="polite"></div>
  </div>
</div>
</section>
</main>

<footer class="mega-footer">
<div class="container mf-grid">
<div class="mf-brand">
<div class="brand big">
<img alt="Travirae" src="assets/img/common/plane-logo.png" style="height:28px"/>
<span>Travirae</span>
</div>
<p class="muted">La tua piattaforma di ispirazione e prenotazione hotel con mappa interattiva.</p>
<div class="mf-socials">
  <a class="social social--icon" href="https://www.instagram.com/travirae_official/" aria-label="Instagram" target="_blank" rel="noopener">
    <img src="https://upload.wikimedia.org/wikipedia/commons/e/e7/Instagram_logo_2016.svg" alt="" loading="lazy"/>
  </a>
  <a class="social social--icon" href="https://www.facebook.com/profile.php?id=61573037940606" aria-label="Facebook" target="_blank" rel="noopener">
    <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg" alt="" loading="lazy"/>
  </a>
  <a class="social social--icon" href="https://www.tiktok.com/@travirae?lang=en" aria-label="TikTok" target="_blank" rel="noopener">
    <img src="https://upload.wikimedia.org/wikipedia/commons/a/a6/Tiktok_icon.svg" alt="" loading="lazy"/>
  </a>
  <a class="social social--icon" href="https://www.youtube.com/channel/UCgGtp3qTHUzMPqjpT8EnRbQ" aria-label="YouTube" target="_blank" rel="noopener">
    <img src="https://upload.wikimedia.org/wikipedia/commons/0/09/YouTube_full-color_icon_%282017%29.svg" alt="" loading="lazy"/>
  </a>
</div>
</div>
<nav class="mf-services"><h4>Servizi</h4><ul>
<li><a href="flights.html">Voli</a></li>
<li><a href="index.html">Hotel</a></li>
<li><a href="programma-affiliato.html">Programma affiliato</a></li>
</ul></nav>
<div class="mf-contact">
<h4>Resta in contatto</h4>
<ul class="contact-list">
<li>✉️ info@travirae.example</li>
<li>Iscriviti alla nostra newsletter</li>
</ul>
<form class="newsletter-form wide" data-netlify="true" method="POST" name="newsletter">
<input aria-label="Email per newsletter" name="email" placeholder="La tua email" required="" type="email"/>
<button class="btn" type="submit">Iscriviti</button>
</form>
</div>
</div>
<div class="container mf-bottom muted small">
<div>© <span id="year-copy"></span> Travirae · Tutti i diritti riservati</div>
<div class="mf-legal">
<a href="privacy.html">Privacy</a> · <a href="termini.html">Termini</a> · <a href="cookie.html">Cookie</a>
</div>
</div>
</footer>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="assets/js/config.js"></script>
<script src="assets/js/supabase-init.js"></script>
<script src="assets/js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="assets/js/admin-affiliati.js"></script>
</body>
</html>
