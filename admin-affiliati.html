
<!DOCTYPE html>

<html lang="it">
<head>
<link href="assets/img/common/plane-logo.png" rel="icon" type="image/png"/>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Pannello admin affiliati – Travirae</title>
<meta content="Pannello admin per monitorare vendite, commissioni nette, payout affiliati e margine Travirae aggregato per mese e per affiliato." name="description"/>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
<link href="assets/css/style.css" rel="stylesheet"/>
<script id="travirae-lang-router">(function(){
  try{
    var key='travirae_email_lang';
    var lang='';
    try{ lang=String(localStorage.getItem(key)||'').toUpperCase(); }catch(e){}
    if(!lang) return;

    var map={DEU:'de', ENG:'en', FRA:'fr', SPA:'es', RUS:'ru', ARA:'ar', NLD:'nl'};
    var suf=map[lang];
    if(!suf) return;

    var u=new URL(window.location.href);
    var path=u.pathname||'';
    var file=path.split('/').pop()||'';
    var dir=path.slice(0, path.length - file.length);
    if(!file) file='index.html';

    // If already on the correct language page, do nothing
    var reTarget=new RegExp('-'+suf+'\\.html$','i');
    if(reTarget.test(file)) return;

    // Only handle .html pages
    if(!/\\.html$/i.test(file)) return;

    // Strip any other supported suffix, then append the requested one
    var target=file.replace(/-(de|en|fr|es|ru|ar|nl)\\.html$/i,'.html').replace(/\\.html$/i,'-'+suf+'.html');
    u.pathname = dir + target;
    window.location.replace(u.toString());
  }catch(e){}
})();</script>
</head>
<body class="page--affiliate-admin">
<header class="site-header">
<div class="container header-inner">
<a aria-label="Travirae Home" class="brand" href="index.html">
<img alt="Travirae" src="assets/img/common/plane-logo.png" style="height:28px"/>
<span>Travirae</span>
</a>
<nav aria-label="Navigazione principale" class="main-nav">
<a class="nav-link" href="index.html">Hotel</a>
<a class="nav-link" href="flights.html">Voli</a>
<a class="nav-link" href="programma-affiliato.html">Programma affiliato</a>
</nav>
<button aria-expanded="false" aria-label="Apri menu" class="nav-toggle"><span></span><span></span><span></span></button>
</div>
</header>
<main>
<section class="section">
<div class="container">
<div class="auth-card">
<div class="admin-header">
<h1 id="admin-title" style="font-size:1.3rem;margin:0 0 4px;">Dashboard admin affiliati</h1>
<p class="muted small" id="admin-subtitle" style="margin:0;">Accedi con l'account admin per vedere le statistiche globali del programma affiliati.</p>
</div>
<div id="admin-view-login">
<form autocomplete="on" class="auth-form" id="admin-login-form">
<div class="form-group">
<label for="admin-email">Email admin</label>
<input id="admin-email" name="email" required="" type="email"/>
</div>
<div class="form-group">
<label for="admin-password">Password</label>
<input id="admin-password" name="password" required="" type="password"/>
</div>
<div class="auth-actions">
<button class="btn" type="submit">Accedi</button>
</div>
</form>
</div>
<div hidden="" id="admin-view-dashboard">
<div class="admin-stats-grid">
<div class="stat-card">
<div class="stat-label">Vendite valide (mese corrente)</div>
<div class="stat-value" id="admin-total-sales">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Commissioni nette (mese corrente)</div>
<div class="stat-value" id="admin-total-net">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Payout affiliati (mese corrente)</div>
<div class="stat-value" id="admin-total-aff">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Margine Travirae (mese corrente)</div>
<div class="stat-value" id="admin-total-trav">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Vendite dirette (senza affiliato)</div>
<div class="stat-value" id="admin-direct-sales">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Commissioni dirette (senza affiliato)</div>
<div class="stat-value" id="admin-direct-net">—</div>
</div>
</div>
<h2 class="admin-section-title">Traffico sito (mese corrente)</h2>
<div class="admin-stats-grid">
<div class="stat-card">
<div class="stat-label">Visite totali</div>
<div class="stat-value" id="admin-traffic-visits">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Pageview totali</div>
<div class="stat-value" id="admin-traffic-pageviews">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Visite da affiliati</div>
<div class="stat-value" id="admin-traffic-visits-affiliate">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Visite dirette</div>
<div class="stat-value" id="admin-traffic-visits-direct">—</div>
</div>
</div>
<div class="admin-note" style="margin-top:10px;">
<span class="muted small">Le “visite” sono sessioni (session_id) uniche; i “pageview” sono caricamenti pagina registrati dal sito. I dati includono traffico con e senza parametro <code>?ref=</code>.</span>
</div>
<h2 class="admin-section-title" style="margin-top:18px;">Booking click sito (mese corrente)</h2>
<div class="admin-stats-grid">
<div class="stat-card">
<div class="stat-label">Booking click totali</div>
<div class="stat-value" id="admin-bclick-total">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Booking click da affiliati</div>
<div class="stat-value" id="admin-bclick-affiliate">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Booking click diretti (senza affiliato)</div>
<div class="stat-value" id="admin-bclick-direct">—</div>
</div>
</div>
<div class="admin-note" style="margin-top:10px;">
<span class="muted small">I “booking click” sono i click dentro i widget (Stay22 / Aviasales) che portano l’utente fuori dal sito. <strong>Non sono</strong> vendite confermate.</span>
</div>
<div class="admin-actions">
<button class="btn secondary" id="admin-reload-btn" type="button">Ricarica dati</button>
<button class="btn secondary" id="admin-import-aviasales-btn" type="button">Importa vendite Aviasales</button>
<button class="btn secondary" id="admin-import-stay22-csv-btn" type="button">Importa Stay22 CSV</button>
<input accept=".csv,text/csv" hidden="" id="admin-stay22-csv-input" type="file"/>
<button class="btn secondary" id="admin-refresh-payouts-btn" type="button">Aggiorna payouts</button>
<button class="btn secondary" id="admin-2fa-btn" type="button">Sicurezza (2FA)</button>
<button class="btn" id="admin-logout-btn" type="button">Esci</button>
</div>
<details class="admin-accordion" id="admin-newsletter-accordion">
<summary class="admin-section-title admin-accordion-summary">Newsletter</summary>
<div class="admin-stats-grid" style="margin-top: 10px;">
<div class="stat-card">
<div class="stat-label">Iscritti newsletter (totale)</div>
<div class="stat-value" id="admin-newsletter-count">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Iscritti ITA</div>
<div class="stat-value" id="admin-newsletter-count-ITA">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Iscritti ENG</div>
<div class="stat-value" id="admin-newsletter-count-ENG">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Iscritti ARA</div>
<div class="stat-value" id="admin-newsletter-count-ARA">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Iscritti DEU</div>
<div class="stat-value" id="admin-newsletter-count-DEU">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Iscritti SPA</div>
<div class="stat-value" id="admin-newsletter-count-SPA">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Iscritti RUS</div>
<div class="stat-value" id="admin-newsletter-count-RUS">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Iscritti NLD</div>
<div class="stat-value" id="admin-newsletter-count-NLD">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Iscritti ZHO</div>
<div class="stat-value" id="admin-newsletter-count-ZHO">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Iscritti FRA</div>
<div class="stat-value" id="admin-newsletter-count-FRA">—</div>
</div>
</div>
<div class="admin-card" style="margin-top: 12px;">
<form class="admin-newsletter-form" id="admin-newsletter-form">
<p class="muted small" style="margin: 0 0 12px;">
            Per inviare la newsletter devi compilare <strong>OGGETTO</strong> e <strong>TESTO</strong> per <strong>tutte le lingue</strong>.
            Se manca anche un solo campo, l’invio verrà bloccato.
            La newsletter verrà inviata nella lingua salvata al momento dell’iscrizione (es. se l’utente si iscrive con il sito su ENG, riceverà la newsletter in ENG).
          </p>
<div class="admin-newsletter-grid">
<div class="admin-newsletter-lang" data-lang="ITA">
<div class="admin-newsletter-lang-head"><span class="code">ITA</span><span class="name">Italiano</span></div>
<label for="newsletter-subject-ITA">Oggetto</label>
<input autocomplete="off" id="newsletter-subject-ITA" placeholder="Oggetto (ITA)" type="text"/>
<label for="newsletter-body-ITA">Testo</label>
<textarea id="newsletter-body-ITA" placeholder="Testo newsletter (ITA)" rows="6"></textarea>
</div>
<div class="admin-newsletter-lang" data-lang="ENG">
<div class="admin-newsletter-lang-head"><span class="code">ENG</span><span class="name">English</span></div>
<label for="newsletter-subject-ENG">Subject</label>
<input autocomplete="off" id="newsletter-subject-ENG" placeholder="Subject (ENG)" type="text"/>
<label for="newsletter-body-ENG">Body</label>
<textarea id="newsletter-body-ENG" placeholder="Newsletter body (ENG)" rows="6"></textarea>
</div>
<div class="admin-newsletter-lang" data-lang="FRA">
<div class="admin-newsletter-lang-head"><span class="code">FRA</span><span class="name">Français</span></div>
<label for="newsletter-subject-FRA">Objet</label>
<input autocomplete="off" id="newsletter-subject-FRA" placeholder="Objet (FRA)" type="text"/>
<label for="newsletter-body-FRA">Texte</label>
<textarea id="newsletter-body-FRA" placeholder="Texte newsletter (FRA)" rows="6"></textarea>
</div>
<div class="admin-newsletter-lang" data-lang="DEU">
<div class="admin-newsletter-lang-head"><span class="code">DEU</span><span class="name">Deutsch</span></div>
<label for="newsletter-subject-DEU">Betreff</label>
<input autocomplete="off" id="newsletter-subject-DEU" placeholder="Betreff (DEU)" type="text"/>
<label for="newsletter-body-DEU">Text</label>
<textarea id="newsletter-body-DEU" placeholder="Newsletter-Text (DEU)" rows="6"></textarea>
</div>
<div class="admin-newsletter-lang" data-lang="SPA">
<div class="admin-newsletter-lang-head"><span class="code">SPA</span><span class="name">Español</span></div>
<label for="newsletter-subject-SPA">Asunto</label>
<input autocomplete="off" id="newsletter-subject-SPA" placeholder="Asunto (SPA)" type="text"/>
<label for="newsletter-body-SPA">Texto</label>
<textarea id="newsletter-body-SPA" placeholder="Texto newsletter (SPA)" rows="6"></textarea>
</div>
<div class="admin-newsletter-lang" data-lang="NLD">
<div class="admin-newsletter-lang-head"><span class="code">NLD</span><span class="name">Nederlands</span></div>
<label for="newsletter-subject-NLD">Onderwerp</label>
<input autocomplete="off" id="newsletter-subject-NLD" placeholder="Onderwerp (NLD)" type="text"/>
<label for="newsletter-body-NLD">Tekst</label>
<textarea id="newsletter-body-NLD" placeholder="Nieuwsbrieftekst (NLD)" rows="6"></textarea>
</div>
<div class="admin-newsletter-lang" data-lang="RUS">
<div class="admin-newsletter-lang-head"><span class="code">RUS</span><span class="name">Русский</span></div>
<label for="newsletter-subject-RUS">Тема</label>
<input autocomplete="off" id="newsletter-subject-RUS" placeholder="Тема (RUS)" type="text"/>
<label for="newsletter-body-RUS">Текст</label>
<textarea id="newsletter-body-RUS" placeholder="Текст рассылки (RUS)" rows="6"></textarea>
</div>
<div class="admin-newsletter-lang" data-lang="ARA">
<div class="admin-newsletter-lang-head"><span class="code">ARA</span><span class="name">العربية</span></div>
<label for="newsletter-subject-ARA">الموضوع</label>
<input autocomplete="off" id="newsletter-subject-ARA" placeholder="الموضوع (ARA)" type="text"/>
<label for="newsletter-body-ARA">النص</label>
<textarea id="newsletter-body-ARA" placeholder="نص النشرة (ARA)" rows="6"></textarea>
</div>
<div class="admin-newsletter-lang" data-lang="ZHO">
<div class="admin-newsletter-lang-head"><span class="code">ZHO</span><span class="name">中文</span></div>
<label for="newsletter-subject-ZHO">主题</label>
<input autocomplete="off" id="newsletter-subject-ZHO" placeholder="主题 (ZHO)" type="text"/>
<label for="newsletter-body-ZHO">正文</label>
<textarea id="newsletter-body-ZHO" placeholder="通讯内容 (ZHO)" rows="6"></textarea>
</div>
</div>
<div class="admin-actions" style="justify-content:flex-end; margin-top: 12px;">
<button class="btn secondary" id="admin-newsletter-clear-btn" type="button">Cancella bozze</button>
<button class="btn btn-primary" id="admin-newsletter-send-btn" type="submit">Invia newsletter</button>
</div>
<div class="admin-message" id="admin-newsletter-status" style="display:none; margin-top: 10px;"></div>
<!-- Mini preview HTML: scegli una lingua e vedi l'email prima di inviare -->
<div aria-label="Anteprima newsletter HTML" class="admin-newsletter-preview">
<div class="admin-newsletter-preview__head">
<div class="admin-newsletter-preview__title">Anteprima newsletter (HTML)</div>
<div class="admin-newsletter-preview__controls">
<label class="small muted" for="admin-newsletter-preview-lang">Lingua</label>
<select aria-label="Seleziona lingua anteprima" class="admin-newsletter-preview__select" id="admin-newsletter-preview-lang"></select>
</div>
</div>
<div class="admin-newsletter-preview__meta small muted">
<span>Oggetto:</span>
<span class="admin-newsletter-preview__subject" id="admin-newsletter-preview-subject"></span>
</div>
<div class="admin-newsletter-preview__meta small muted">
<span>Testo (HTML):</span>
</div>
<textarea class="admin-newsletter-preview__raw" id="admin-newsletter-preview-body" readonly="" rows="6"></textarea>
<iframe class="admin-newsletter-preview__iframe" id="admin-newsletter-preview-iframe" sandbox="" title="Anteprima newsletter"></iframe>
</div>
</form>
</div>
</details>
<h2 class="admin-section-title">Andamento mensile (aggregato)</h2>
<div class="admin-table-wrapper">
<table class="admin-table">
<thead>
<tr>
<th>Mese</th>
<th>Vendite</th>
<th>Commissioni nette</th>
<th>Payout affiliati</th>
<th>Margine Travirae</th>
</tr>
</thead>
<tbody id="admin-monthly-tbody">
<tr><td class="muted small" colspan="5">Nessun dato disponibile.</td></tr>
</tbody>
</table>
</div>
<h2 class="admin-section-title">Riepilogo per affiliato</h2>
<div class="admin-table-wrapper">
<table class="admin-table">
<thead>
<tr>
<th>Affiliate ID</th>
<th>Vendite</th>
<th>Commissioni nette</th>
<th>Payout affiliati</th>
<th>Margine Travirae</th>
</tr>
</thead>
<tbody id="admin-affiliates-tbody">
<tr><td class="muted small" colspan="5">Nessun dato disponibile.</td></tr>
</tbody>
</table>
</div>
<h2 class="admin-section-title">Operativo (click e booking click)</h2>
<p class="muted small" style="margin-top:-4px;">“Booking click” = click dentro i widget (Stay22 / Aviasales) che porta l’utente fuori dal sito. Non è una vendita confermata.</p>
<div class="admin-table-wrapper">
<table class="admin-table">
<thead>
<tr>
<th>Affiliate ID</th>
<th>Email</th>
<th>Click link</th>
<th>Booking click tot.</th>
<th>Booking click Aviasales</th>
<th>Booking click Stay22</th>
<th>Vendite confermate (mese)</th>
<th>Revenue share (mese)</th>
<th>Guadagno mese</th>
<th>Saldo disponibile</th>
<th>Richieste in attesa</th>
<th>Ultima attività</th>
</tr>
</thead>
<tbody id="admin-affiliates-kpi-tbody">
<tr><td class="muted small" colspan="12">Nessun dato disponibile.</td></tr>
</tbody>
</table>
</div>
<h2 class="admin-section-title">Richieste pagamento</h2>
<div class="admin-table-wrapper">
<table class="admin-table">
<thead>
<tr>
<th>Data</th>
<th>Affiliate</th>
<th>Importo (USD)</th>
<th>Metodo</th>
<th>Stato</th>
<th>Dettagli</th>
<th>Azioni</th>
</tr>
</thead>
<tbody id="admin-payout-requests-tbody">
<tr><td class="muted small" colspan="7">Nessuna richiesta pagamento.</td></tr>
</tbody>
</table>
</div>
</div>
<div style="margin-top:18px;">
<h2 class="admin-section-title">Grafico (affiliati vs Travirae)</h2>
<div style="height:260px;">
<canvas aria-label="Grafico guadagni affiliati vs Travirae" id="admin-earnings-chart"></canvas>
</div>
</div>
</div>
<div aria-live="polite" class="admin-message" id="admin-message"></div>
</div>

</section>
</main>
<footer class="mega-footer">
<div class="container mf-grid">
<div class="mf-brand">
<div class="brand big">
<img alt="Travirae" src="assets/img/common/plane-logo.png" style="height:28px"/>
<span>Travirae</span>
</div>
<p class="muted">La tua piattaforma di ispirazione e prenotazione hotel con mappa interattiva.</p>
<div class="mf-socials">
<a aria-label="Instagram" class="social social--icon" href="https://www.instagram.com/travirae_official/" rel="noopener" target="_blank">
<img alt="" loading="lazy" src="https://upload.wikimedia.org/wikipedia/commons/e/e7/Instagram_logo_2016.svg"/>
</a>
<a aria-label="Facebook" class="social social--icon" href="https://www.facebook.com/profile.php?id=61573037940606" rel="noopener" target="_blank">
<img alt="" loading="lazy" src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg"/>
</a>
<a aria-label="TikTok" class="social social--icon" href="https://www.tiktok.com/@travirae?lang=en" rel="noopener" target="_blank">
<img alt="" loading="lazy" src="https://upload.wikimedia.org/wikipedia/commons/a/a6/Tiktok_icon.svg"/>
</a>
<a aria-label="YouTube" class="social social--icon" href="https://www.youtube.com/channel/UCgGtp3qTHUzMPqjpT8EnRbQ" rel="noopener" target="_blank">
<img alt="" loading="lazy" src="https://upload.wikimedia.org/wikipedia/commons/0/09/YouTube_full-color_icon_%282017%29.svg"/>
</a>
</div>
</div>
<nav class="mf-services"><h4>Servizi</h4><ul>
<li><a href="flights.html">Voli</a></li>
<li><a href="index.html">Hotel</a></li>
<li><a href="programma-affiliato.html">Programma affiliato</a></li>
</ul></nav>
<div class="mf-contact">
<h4>Resta in contatto</h4>
<ul class="contact-list">
<li>✉️ info@travirae.com</li>
<li>Iscriviti alla nostra newsletter</li>
</ul>
<!-- Newsletter (gestita via Supabase Edge Function).
     Usiamo method="get" e un id fisso per evitare submit POST (405) se JS non è caricato. -->
<form action="#" class="newsletter-form wide" id="newsletter-form" method="get">
<input aria-label="Email per newsletter" name="newsletter_email" placeholder="La tua email" required="" type="email"/>
<button class="btn" type="submit">Iscriviti</button>
</form>
</div>
</div>
<div class="container mf-bottom muted small">
<div>© <span id="year-copy"></span> Travirae · Tutti i diritti riservati</div>
<div class="mf-legal">
<a href="privacy.html">Privacy</a> · <a href="termini.html">Termini</a> · <a href="cookie.html">Cookie</a>
</div>
</div>
</footer>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="assets/js/config.js"></script>
<script src="assets/js/supabase-init.js"></script>
<script src="assets/js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="assets/js/admin-affiliati.js"></script>
</body>
</html>
