<!DOCTYPE html>

<html lang="it">
<head>
<link href="assets/img/common/plane-logo.png" rel="icon" type="image/png"/>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Voli – compara e trova l’offerta giusta | Travirae</title>
<meta content="Confronta voli in pochi clic e trova l’offerta giusta per la tua prossima destinazione." name="description"/>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
<link href="assets/css/style.css" rel="stylesheet"/>
<meta content="Voli – Travirae" property="og:title"/><meta content="Confronta voli e organizza il tuo viaggio con facilità." property="og:description"/><meta content="website" property="og:type"/><meta content="assets/img/common/hero.jpg" property="og:image"/><meta content="summary_large_image" name="twitter:card"/><meta content="Voli – Travirae" name="twitter:title"/><meta content="Confronta tariffe e scegli il volo ideale per te." name="twitter:description"/><meta content="assets/img/common/hero.jpg" name="twitter:image"/></head>
<body class="page--flights">
<header class="site-header">
<link href="assets/img/common/plane-logo.png" rel="icon" type="image/png"/>
<div class="container header-inner">
<a aria-label="Travirae Home" class="brand" href="index.html">
<img alt="Travirae" src="assets/img/common/plane-logo.png" style="height:28px"/>
<span>Travirae</span>
</a>
<nav aria-label="Navigazione principale" class="main-nav"><a class="nav-link" href="index.html">Hotel</a>
<a class="nav-link active" href="flights.html">Voli</a>
<a class="nav-link" href="programma-affiliato.html">Programma affiliato</a></nav>
<button aria-expanded="false" aria-label="Apri menu" class="nav-toggle">
<span></span><span></span><span></span>
</button>
</div>
</header>
<main>
<div class="flights-zone">
<section class="hero hero--alt hero--light">
<div aria-label="Ricerca voli" class="hero-bg hero-bg--plane" role="img"></div>
<div class="container hero-inner center">
<h1>Trova i voli migliori</h1>
<p class="subtitle"><span style="color:black;">Compila i campi e apri la ricerca su Aviasales</span></p>
</div>
</section>
<section class="section" id="aviasales-widget">
<div class="container">
<div class="card center" style="padding:12px 8px">
<div id="aviasales-widget-wrapper" style="position:relative;">
  <div id="aviasales-overlay" aria-hidden="true" style="position:absolute; inset:0; z-index:5; display:none; background:transparent;"></div>
  <div id="aviasales-widget-container"></div>
</div>
<script>
(function(){
  // Map Travirae language (ITA/ENG/...) -> widget locale (it/en/...).
  function getSiteLangCode(){
    try {
      if (typeof window.TraviraeGetSiteLang === 'function') {
        return window.TraviraeGetSiteLang();
      }
    } catch (e) {}
    try {
      var stored = localStorage.getItem('travirae_lang');
      if (stored) return stored;
    } catch (e2) {}
    // Fallback: browser language
    var nav = (navigator.languages && navigator.languages.length ? navigator.languages[0] : (navigator.language || 'en'));
    nav = String(nav).toLowerCase();
    if (nav.startsWith('it')) return 'ITA';
    if (nav.startsWith('fr')) return 'FRA';
    if (nav.startsWith('es')) return 'SPA';
    if (nav.startsWith('de')) return 'DEU';
    if (nav.startsWith('ru')) return 'RUS';
    if (nav.startsWith('nl')) return 'NLD';
    if (nav.startsWith('zh')) return 'ZHO';
    if (nav.startsWith('ar')) return 'ARA';
    return 'ENG';
  }

  function mapSiteLangToLocale(code){
    var c = String(code || 'ENG').toUpperCase();
    var map = { ITA:'it', ENG:'en', FRA:'fr', SPA:'es', DEU:'de', RUS:'ru', NLD:'nl', ZHO:'zh', ARA:'ar' };
    return map[c] || 'en';
  }

  function getAffiliateSlug(){
    try {
      if (window.traviraeAffiliate && typeof window.traviraeAffiliate.getId === 'function') {
        return window.traviraeAffiliate.getId() || '';
      }
    } catch (e) {}
    return '';
  }

  function buildWidgetSrc(locale, affiliateSlug){
    var base =
      "https://tpemd.com/content?currency=usd&trs=454819&shmarker=669407&show_hotels=false&powered_by=true" +
      "&locale=" + encodeURIComponent(locale) +
      "&searchUrl=www.aviasales.com%2Fsearch" +
      "&primary_override=%232739FEff&color_button=%232739FEff&color_icons=%232739FEff&dark=%23262626&light=%23FFFFFF&secondary=%23FFFFFF&special=%23C4C4C4&color_focused=%232739FEff&border_radius=30&no_labels=&plain=true&promo_id=7879&campaign_id=100";
    if (affiliateSlug) {
      base += "&sub_id=" + encodeURIComponent(affiliateSlug);
    }
    return base;
  }

  var _currentLocale = null;

  // --- Tracking booking click Aviasales (robusto su desktop, incognito e mobile) ---
  function bindTrackingOnce(){
    if (window.__tva_aviasales_tracking_bound) return;
    window.__tva_aviasales_tracking_bound = true;

    var container = document.getElementById('aviasales-widget-container');
    var listenEl = document.getElementById('aviasales-widget-wrapper') || container || document;

    try {
      var lastGestureTs = 0;
      function nowMs(){ return (Date.now ? Date.now() : (new Date()).getTime()); }
      function isAviasalesUrl(u){
        try{
          if (!u) return false;
          var s = String(u);
          return /aviasales\.|travelpayouts\.|tp\.media|tpemd\.com|hotellook\.|jetradar\./i.test(s);
        }catch(e){ return false; }
      }
      function safeTrack(reason){
        try{
          if (window.traviraeAffiliate && typeof window.traviraeAffiliate.trackBookingClick === 'function') {
            if (window.console && console.log) console.log('Travirae: booking click Aviasales', reason || '');
            window.traviraeAffiliate.trackBookingClick('aviasales');
          }
        }catch(e){}
      }
      function markGesture(){ lastGestureTs = nowMs(); }

      var gestureHandler = function(){ markGesture(); };
      listenEl.addEventListener('pointerdown', gestureHandler, true);
      listenEl.addEventListener('mousedown', gestureHandler, true);
      listenEl.addEventListener('touchstart', gestureHandler, { capture: true, passive: true });

      var clickHandler = function(e){
        try{
          markGesture();
          var t = (e && e.target) ? e.target : null;
          if (!t || !t.closest) return;
          if (t.closest('input, textarea, select, [contenteditable="true"]')) return;

          var a = t.closest('a');
          if (a && a.href && isAviasalesUrl(a.href)) { safeTrack('link'); return; }

          var btnLike = t.closest('button, [role="button"], input[type="submit"], input[type="button"], [onclick], [data-action], [data-testid], .btn, .button, [class*="btn"], [class*="button"], [class*="submit"], [class*="search"]');
          if (btnLike) { safeTrack('button-like'); return; }

          if (t.closest('#aviasales-widget-wrapper')) { safeTrack('fallback'); }
        }catch(err){}
      };
      listenEl.addEventListener('click', clickHandler, true);

      var submitHandler = function(){
        try{ markGesture(); safeTrack('submit'); }catch(err){}
      };
      listenEl.addEventListener('submit', submitHandler, true);

      // Patch window.open una sola volta
      try{
        if (!window.__tva_aviasales_open_patch) {
          window.__tva_aviasales_open_patch = true;
          var _origOpen = window.open;
          if (typeof _origOpen === 'function') {
            window.open = function(url){
              try{
                if (isAviasalesUrl(url)) {
                  var dt = nowMs() - (lastGestureTs || 0);
                  if (!lastGestureTs || dt < 15000) safeTrack('window.open');
                }
              }catch(e){}
              return _origOpen.apply(this, arguments);
            };
          }
        }
      }catch(eOpen){}

      // Fallback same-tab: se dopo una gesture il tab si chiude/nasconde subito, contiamo.
      try{
        var _pageHideHandler = function(){
          try{
            var dt = nowMs() - (lastGestureTs || 0);
            if (lastGestureTs && dt < 1200) safeTrack('pagehide');
          }catch(e){}
        };
        window.addEventListener('pagehide', _pageHideHandler, true);
        window.addEventListener('beforeunload', _pageHideHandler, true);
      }catch(ePh){}

    } catch(eBind) {
      if (window.console && console.warn) console.warn('Travirae: impossibile collegare tracking Aviasales', eBind);
    }
  }

  function ensureOverlayBound(){
    var overlay = document.getElementById('aviasales-overlay');
    if (!overlay) return null;

    // Bind once
    if (overlay.dataset.traviraeBound === '1') return overlay;
    overlay.dataset.traviraeBound = '1';

    try { overlay.style.zIndex = '999999'; } catch(eZ){}
    try { overlay.style.background = 'transparent'; } catch(eB){}

    var fireOverlay = function(){
      if (overlay.dataset.traviraeFired === '1') return;
      overlay.dataset.traviraeFired = '1';
      try {
        if (window.traviraeAffiliate && typeof window.traviraeAffiliate.trackBookingClick === 'function') {
          if (window.console && console.log) console.log('Travirae: booking click Aviasales (overlay)');
          window.traviraeAffiliate.trackBookingClick('aviasales');
        }
      } catch(eTrack){}
      // Disattiva overlay ma NON rimuoverlo (serve anche quando la lingua cambia e il widget si ricarica)
      try { overlay.style.pointerEvents = 'none'; overlay.style.opacity = '0'; overlay.style.display = 'none'; } catch(eCss){}
    };

    overlay.addEventListener('pointerdown', fireOverlay, true);
    overlay.addEventListener('mousedown', fireOverlay, true);
    overlay.addEventListener('touchstart', fireOverlay, { capture: true, passive: true });

    return overlay;
  }

  function refreshOverlayVisibility(reset){
    var overlay = ensureOverlayBound();
    if (!overlay) return;

    if (reset) {
      overlay.dataset.traviraeFired = '0';
      try { overlay.style.pointerEvents = 'auto'; overlay.style.opacity = '0'; } catch(e){}
    }

    // Stop any previous checker
    try {
      if (window.__tva_aviasales_overlay_iv) {
        clearInterval(window.__tva_aviasales_overlay_iv);
        window.__tva_aviasales_overlay_iv = null;
      }
    } catch(e){}

    overlay.style.display = 'none';
    var checks = 0;
    var decide = function(){
      checks++;
      var use = false;
      try {
        use = !!document.querySelector('#aviasales-widget iframe, #aviasales-widget-wrapper iframe, #aviasales-widget-container iframe');
      } catch(eQ) { use = false; }
      overlay.style.display = use ? 'block' : 'none';
      if (use || checks >= 24) {
        try {
          if (window.__tva_aviasales_overlay_iv) {
            clearInterval(window.__tva_aviasales_overlay_iv);
            window.__tva_aviasales_overlay_iv = null;
          }
        } catch(eC){}
      }
    };
    window.__tva_aviasales_overlay_iv = setInterval(decide, 500);
    decide();
  }

  function mountWidget(){
    var locale = mapSiteLangToLocale(getSiteLangCode());
    var container = document.getElementById('aviasales-widget-container');
    if (!container) return;

    // If locale hasn't changed and we already mounted, just refresh overlay detection
    if (_currentLocale === locale && container.querySelector('script[data-travirae-aviasales="1"]')) {
      refreshOverlayVisibility(false);
      return;
    }
    _currentLocale = locale;

    // Clear previous widget instance
    try { container.innerHTML = ''; } catch(e) {}

    var s = document.createElement('script');
    s.async = true;
    s.charset = 'utf-8';
    s.src = buildWidgetSrc(locale, getAffiliateSlug());
    s.dataset.traviraeAviasales = '1';
    container.appendChild(s);

    refreshOverlayVisibility(true);
  }

  function init(){
    bindTrackingOnce();
    mountWidget();
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }

  // Reload widget when the site language changes
  window.addEventListener('travirae:langChanged', function(){
    try { mountWidget(); } catch(e) {}
  });

})();
</script>
</div>
</div>
</section>
<section class="section" id="trustbar-section">
<div class="container">
<!-- Trust bar -->
<div aria-label="Affidabilità Travirae" class="trustbar" role="region">
<div class="trust-item"><div class="value">40k+</div><div class="label">Utenti soddisfatti</div></div>
<div class="trust-item"><div class="value">1k+</div><div class="label">Destinazioni</div></div>
<div class="trust-item"><div class="value">100%</div><div class="label">Partner affidabili</div>
</div>
</div>
</div></section>
<section class="section" id="cta-hotels">
<div class="container">
<div class="center" style="text-align:center">
<a class="btn" href="index.html" style="margin:12px auto;display:inline-block">Cerca hotel</a>
</div>
</div>
</section>
</div><!-- end .flights-zone -->
<section aria-label="I nostri partner" class="section partners-strip">
<div class="container">
<h2 class="section-title">I nostri partner</h2>
<div class="partners-logos">
<img loading="lazy" decoding="async" alt="Booking.com" src="https://upload.wikimedia.org/wikipedia/commons/b/be/Booking.com_logo.svg"/>
<img loading="lazy" decoding="async" alt="Expedia" src="https://upload.wikimedia.org/wikipedia/commons/3/3b/Expedia_Logo_2023.svg"/>
<img loading="lazy" decoding="async" alt="agoda" src="https://upload.wikimedia.org/wikipedia/commons/c/ca/Agoda_logo.svg"/>
<img loading="lazy" decoding="async" alt="Hotels.com" src="https://upload.wikimedia.org/wikipedia/commons/1/16/Hotels.com_Logo_2023.svg"/>
<img loading="lazy" decoding="async" alt="Trip.com" src="https://upload.wikimedia.org/wikipedia/commons/7/7a/Trip.com_logo.svg"/>
<img loading="lazy" decoding="async" alt="Vrbo" src="https://upload.wikimedia.org/wikipedia/commons/5/51/Vrbo.svg"/>
<img loading="lazy" decoding="async" alt="aviasales" src="https://upload.wikimedia.org/wikipedia/commons/9/96/Aviasales_logo_horizontal.png"/>
<img loading="lazy" decoding="async" alt="Stay22" src="https://lando.stay22.com/hs-fs/hubfs/Stay22_Logo_V2.png?width=240&amp;height=62&amp;name=Stay22_Logo_V2.png"/>
<img loading="lazy" decoding="async" alt="Travelpayouts" src="https://static.tildacdn.com/tild6233-6365-4238-b865-393237323037/versionVERT_colorPRI.png"/>
<img loading="lazy" decoding="async" alt="Hotellook" src="assets/img/partners/hotellook.png"/>
</div>
</div>
</section>
</main>
<footer class="mega-footer">
<div class="container mf-grid">
<div class="mf-brand">
<div class="brand big">
<img alt="Travirae" src="assets/img/common/plane-logo.png" style="height:28px"/>
<span>Travirae</span>
</div>
<p class="muted">La tua piattaforma di ispirazione e prenotazione hotel con mappa interattiva.</p>
<div class="mf-socials">
<a aria-label="Instagram" class="social social--icon" href="https://www.instagram.com/travirae_official/" rel="noopener" target="_blank">
<img alt="" loading="lazy" src="https://upload.wikimedia.org/wikipedia/commons/e/e7/Instagram_logo_2016.svg"/>
</a>
<a aria-label="Facebook" class="social social--icon" href="https://www.facebook.com/profile.php?id=61573037940606" rel="noopener" target="_blank">
<img alt="" loading="lazy" src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg"/>
</a>
<a aria-label="TikTok" class="social social--icon" href="https://www.tiktok.com/@travirae?lang=en" rel="noopener" target="_blank">
<img alt="" loading="lazy" src="https://upload.wikimedia.org/wikipedia/commons/a/a6/Tiktok_icon.svg"/>
</a>
<a aria-label="YouTube" class="social social--icon" href="https://www.youtube.com/channel/UCgGtp3qTHUzMPqjpT8EnRbQ" rel="noopener" target="_blank">
<img alt="" loading="lazy" src="https://upload.wikimedia.org/wikipedia/commons/0/09/YouTube_full-color_icon_%282017%29.svg"/>
</a>
</div>
</div>
<nav class="mf-services"><h4>Servizi</h4><ul>
<li><a href="flights.html">Voli</a></li>
<li><a href="index.html">Hotel</a></li>
<li><a href="programma-affiliato.html">Programma affiliato</a></li>
</ul></nav>
<div class="mf-contact">
<h4>Resta in contatto</h4>
<ul class="contact-list">
<li>✉️ info@travirae.com</li>
<li>Iscriviti alla nostra newsletter</li>
</ul>
<!-- Newsletter (gestita via Supabase Edge Function).
     Usiamo method="get" e un id fisso per evitare submit POST (che su hosting statici può dare 405). -->
<form id="newsletter-form" class="newsletter-form wide" action="#" method="get">
<input aria-label="Email per newsletter" name="newsletter_email" placeholder="La tua email" required="" type="email"/>
<button class="btn" type="submit">Iscriviti</button>
</form>
</div>
</div>
<div class="container mf-bottom muted small">
<div>© <span id="year-copy"></span> Travirae · Tutti i diritti riservati</div>
<div class="mf-legal">
<a href="privacy.html">Privacy</a> · <a href="termini.html">Termini</a> · <a href="cookie.html">Cookie</a>
</div>
</div>
</footer>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="assets/js/config.js"></script>
<script src="assets/js/supabase-init.js"></script>
<script src="assets/js/main.js"></script>
</body>
</html>
