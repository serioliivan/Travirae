
<!DOCTYPE html>

<html lang="de">
<head>
<link href="assets/img/common/plane-logo.png" rel="icon" type="image/png"/>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Admin – Partnerprogramm | Travirae</title>
<meta content="Admin-Dashboard zur Überwachung von Verkäufen, Netto-Provisionen, Affiliate-Auszahlungen und Travirae-Marge – aggregiert nach Monat und Affiliate." name="description"/>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
<link href="assets/css/style.css" rel="stylesheet"/>
<script id="travirae-lang-router">
(function(){
  try{
    var key='travirae_email_lang';
    var lang='';
    try{ lang=String(localStorage.getItem(key)||'').toUpperCase(); }catch(e){}
    var u=new URL(window.location.href);
    var path=u.pathname||'';
    var file=path.split('/').pop()||'';
    var dir=path.slice(0, path.length - file.length);
    if(!file) file='index.html';
    var isDe=/-de\.html$/i.test(file);
    if(lang==='DEU'){
      if(!isDe && /\.html$/i.test(file)){
        u.pathname = dir + file.replace(/\.html$/i,'-de.html');
        window.location.replace(u.toString());
      }
    }else{
      if(isDe){
        u.pathname = dir + file.replace(/-de\.html$/i,'.html');
        window.location.replace(u.toString());
      }
    }
  }catch(e){}
})();
</script>
</head>
<body class="page--affiliate-admin">
<header class="site-header">
<div class="container header-inner">
<a aria-label="Travirae Startseite" class="brand" href="index.html">
<img alt="Travirae" src="assets/img/common/plane-logo.png" style="height:28px"/>
<span>Travirae</span>
</a>
<nav aria-label="Hauptnavigation" class="main-nav">
<a class="nav-link" href="index.html">Hotels</a>
<a class="nav-link" href="flights.html">Flüge</a>
<a class="nav-link" href="programma-affiliato.html">Partnerprogramm</a>
</nav>
<button aria-expanded="false" aria-label="Menü öffnen" class="nav-toggle"><span></span><span></span><span></span></button>
</div>
</header>

<main>
<section class="section">
<div class="container">
  <div class="auth-card">
    <div class="admin-header">
      <h1 id="admin-title" style="font-size:1.3rem;margin:0 0 4px;">Admin-Dashboard Partnerprogramm</h1>
      <p id="admin-subtitle" class="muted small" style="margin:0;">Melde dich mit dem Admin-Konto an, um die globalen Statistiken des Partnerprogramms zu sehen.</p>
    </div>

    <div id="admin-view-login">
      <form id="admin-login-form" class="auth-form" autocomplete="on">
        <div class="form-group">
          <label for="admin-email">Admin-E-Mail</label>
          <input id="admin-email" name="email" type="email" required/>
        </div>
        <div class="form-group">
          <label for="admin-password">Passwort</label>
          <input id="admin-password" name="password" type="password" required/>
        </div>
        <div class="auth-actions">
          <button type="submit" class="btn">Anmelden</button>
        </div>
      </form>
    </div>

    <div id="admin-view-dashboard" hidden>
      <div class="admin-stats-grid">
        <div class="stat-card">
          <div class="stat-label">Gültige Verkäufe (laufender Monat)</div>
          <div class="stat-value" id="admin-total-sales">—</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Netto-Provisionen (laufender Monat)</div>
          <div class="stat-value" id="admin-total-net">—</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Affiliate-Auszahlungen (laufender Monat)</div>
          <div class="stat-value" id="admin-total-aff">—</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Travirae-Marge (laufender Monat)</div>
          <div class="stat-value" id="admin-total-trav">—</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Direkte Verkäufe (ohne Affiliate)</div>
          <div class="stat-value" id="admin-direct-sales">—</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Direkte Netto-Provisionen (ohne Affiliate)</div>
          <div class="stat-value" id="admin-direct-net">—</div>
        </div>
      </div>

      <h2 class="admin-section-title">Website-Traffic (laufender Monat)</h2>
      <div class="admin-stats-grid">
        <div class="stat-card">
          <div class="stat-label">Besuche gesamt</div>
          <div class="stat-value" id="admin-traffic-visits">—</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Pageviews gesamt</div>
          <div class="stat-value" id="admin-traffic-pageviews">—</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Besuche über Affiliates</div>
          <div class="stat-value" id="admin-traffic-visits-affiliate">—</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Direkte Besuche</div>
          <div class="stat-value" id="admin-traffic-visits-direct">—</div>
        </div>
      </div>

      <div class="admin-note" style="margin-top:10px;">
        <span class="muted small">„Besuche“ sind eindeutige Sessions (session_id); „Pageviews“ sind Seitenaufrufe, die von der Website erfasst werden. Die Daten enthalten Traffic mit und ohne Parameter <code>?ref=</code>.</span>
      </div>

      <h2 class="admin-section-title" style="margin-top:18px;">Booking Clicks auf der Website (laufender Monat)</h2>
      <div class="admin-stats-grid">
        <div class="stat-card">
          <div class="stat-label">Booking Clicks gesamt</div>
          <div class="stat-value" id="admin-bclick-total">—</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Booking Clicks über Affiliates</div>
          <div class="stat-value" id="admin-bclick-affiliate">—</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Direkte Booking Clicks (ohne Affiliate)</div>
          <div class="stat-value" id="admin-bclick-direct">—</div>
        </div>
      </div>

      <div class="admin-note" style="margin-top:10px;">
        <span class="muted small">„Booking Clicks“ sind Klicks innerhalb der Widgets (Stay22 / Aviasales), die Nutzerinnen und Nutzer von der Website zu einem Partner weiterleiten. <strong>Das sind keine</strong> bestätigten Verkäufe.</span>
      </div>

      <div class="admin-actions">
        <button type="button" class="btn secondary" id="admin-reload-btn">Daten neu laden</button>
        <button type="button" class="btn secondary" id="admin-import-aviasales-btn">Aviasales-Verkäufe importieren</button>
        <button type="button" class="btn secondary" id="admin-import-stay22-csv-btn">Stay22-CSV importieren</button>
        <input type="file" id="admin-stay22-csv-input" accept=".csv,text/csv" hidden/>
        <button type="button" class="btn secondary" id="admin-refresh-payouts-btn">Auszahlungen aktualisieren</button>
        <button type="button" class="btn secondary" id="admin-2fa-btn">Sicherheit (2FA)</button>
        <button type="button" class="btn" id="admin-logout-btn">Abmelden</button>
      </div>

      <details class="admin-accordion" id="admin-newsletter-accordion">
      <summary class="admin-section-title admin-accordion-summary">Newsletter</summary>

            <div class="admin-stats-grid" style="margin-top: 10px;">
        <div class="stat-card">
          <div class="stat-label">Newsletter-Abonnenten (gesamt)</div>
          <div id="admin-newsletter-count" class="stat-value">—</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Abonnenten (ITA)</div>
          <div id="admin-newsletter-count-ITA" class="stat-value">—</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Abonnenten (ENG)</div>
          <div id="admin-newsletter-count-ENG" class="stat-value">—</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Abonnenten (ARA)</div>
          <div id="admin-newsletter-count-ARA" class="stat-value">—</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Abonnenten (DEU)</div>
          <div id="admin-newsletter-count-DEU" class="stat-value">—</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Abonnenten (SPA)</div>
          <div id="admin-newsletter-count-SPA" class="stat-value">—</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Abonnenten (RUS)</div>
          <div id="admin-newsletter-count-RUS" class="stat-value">—</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Abonnenten (NLD)</div>
          <div id="admin-newsletter-count-NLD" class="stat-value">—</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Abonnenten (ZHO)</div>
          <div id="admin-newsletter-count-ZHO" class="stat-value">—</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Abonnenten (FRA)</div>
          <div id="admin-newsletter-count-FRA" class="stat-value">—</div>
        </div>
      </div>


      <div class="admin-card" style="margin-top: 12px;">
        <form id="admin-newsletter-form" class="admin-newsletter-form">
          <p class="muted small" style="margin: 0 0 12px;">
            Um den Newsletter zu senden, musst du <strong>BETREFF</strong> und <strong>TEXT</strong> für <strong>alle Sprachen</strong> ausfüllen.
            Wenn auch nur ein einziges Feld fehlt, wird der Versand blockiert.
            Der Newsletter wird in der Sprache versendet, die zum Zeitpunkt der Anmeldung gespeichert wurde (z.&nbsp;B. wenn sich jemand auf der Website mit ENG anmeldet, erhält die Person den Newsletter auf Englisch).
          </p>

          <div class="admin-newsletter-grid">
            <div class="admin-newsletter-lang" data-lang="ITA">
              <div class="admin-newsletter-lang-head"><span class="code">ITA</span><span class="name">Italienisch</span></div>
              <label for="newsletter-subject-ITA">Betreff</label>
              <input id="newsletter-subject-ITA" type="text" placeholder="Betreff (ITA)" autocomplete="off" />
              <label for="newsletter-body-ITA">Text</label>
              <textarea id="newsletter-body-ITA" rows="6" placeholder="Newsletter-Text (ITA)"></textarea>
            </div>

            <div class="admin-newsletter-lang" data-lang="ENG">
              <div class="admin-newsletter-lang-head"><span class="code">ENG</span><span class="name">Englisch</span></div>
              <label for="newsletter-subject-ENG">Betreff</label>
              <input id="newsletter-subject-ENG" type="text" placeholder="Betreff (ENG)" autocomplete="off" />
              <label for="newsletter-body-ENG">Text</label>
              <textarea id="newsletter-body-ENG" rows="6" placeholder="Newsletter-Text (ENG)"></textarea>
            </div>

            <div class="admin-newsletter-lang" data-lang="FRA">
              <div class="admin-newsletter-lang-head"><span class="code">FRA</span><span class="name">Französisch</span></div>
              <label for="newsletter-subject-FRA">Betreff</label>
              <input id="newsletter-subject-FRA" type="text" placeholder="Betreff (FRA)" autocomplete="off" />
              <label for="newsletter-body-FRA">Text</label>
              <textarea id="newsletter-body-FRA" rows="6" placeholder="Newsletter-Text (FRA)"></textarea>
            </div>

            <div class="admin-newsletter-lang" data-lang="DEU">
              <div class="admin-newsletter-lang-head"><span class="code">DEU</span><span class="name">Deutsch</span></div>
              <label for="newsletter-subject-DEU">Betreff</label>
              <input id="newsletter-subject-DEU" type="text" placeholder="Betreff (DEU)" autocomplete="off" />
              <label for="newsletter-body-DEU">Text</label>
              <textarea id="newsletter-body-DEU" rows="6" placeholder="Newsletter-Text (DEU)"></textarea>
            </div>

            <div class="admin-newsletter-lang" data-lang="SPA">
              <div class="admin-newsletter-lang-head"><span class="code">SPA</span><span class="name">Spanisch</span></div>
              <label for="newsletter-subject-SPA">Betreff</label>
              <input id="newsletter-subject-SPA" type="text" placeholder="Betreff (SPA)" autocomplete="off" />
              <label for="newsletter-body-SPA">Text</label>
              <textarea id="newsletter-body-SPA" rows="6" placeholder="Newsletter-Text (SPA)"></textarea>
            </div>

            <div class="admin-newsletter-lang" data-lang="NLD">
              <div class="admin-newsletter-lang-head"><span class="code">NLD</span><span class="name">Niederländisch</span></div>
              <label for="newsletter-subject-NLD">Betreff</label>
              <input id="newsletter-subject-NLD" type="text" placeholder="Betreff (NLD)" autocomplete="off" />
              <label for="newsletter-body-NLD">Text</label>
              <textarea id="newsletter-body-NLD" rows="6" placeholder="Newsletter-Text (NLD)"></textarea>
            </div>

            <div class="admin-newsletter-lang" data-lang="RUS">
              <div class="admin-newsletter-lang-head"><span class="code">RUS</span><span class="name">Russisch</span></div>
              <label for="newsletter-subject-RUS">Betreff</label>
              <input id="newsletter-subject-RUS" type="text" placeholder="Betreff (RUS)" autocomplete="off" />
              <label for="newsletter-body-RUS">Text</label>
              <textarea id="newsletter-body-RUS" rows="6" placeholder="Newsletter-Text (RUS)"></textarea>
            </div>

            <div class="admin-newsletter-lang" data-lang="ARA">
              <div class="admin-newsletter-lang-head"><span class="code">ARA</span><span class="name">Arabisch</span></div>
              <label for="newsletter-subject-ARA">Betreff</label>
              <input id="newsletter-subject-ARA" type="text" placeholder="Betreff (ARA)" autocomplete="off" />
              <label for="newsletter-body-ARA">Text</label>
              <textarea id="newsletter-body-ARA" rows="6" placeholder="Newsletter-Text (ARA)"></textarea>
            </div>

            <div class="admin-newsletter-lang" data-lang="ZHO">
              <div class="admin-newsletter-lang-head"><span class="code">ZHO</span><span class="name">Chinesisch</span></div>
              <label for="newsletter-subject-ZHO">Betreff</label>
              <input id="newsletter-subject-ZHO" type="text" placeholder="Betreff (ZHO)" autocomplete="off" />
              <label for="newsletter-body-ZHO">Text</label>
              <textarea id="newsletter-body-ZHO" rows="6" placeholder="Newsletter-Text (ZHO)"></textarea>
            </div>
          </div>

          <div class="admin-actions" style="justify-content:flex-end; margin-top: 12px;">
            <button type="button" class="btn secondary" id="admin-newsletter-clear-btn">Entwürfe löschen</button>
            <button type="submit" class="btn btn-primary" id="admin-newsletter-send-btn">Newsletter senden</button>
          </div>

          <div id="admin-newsletter-status" class="admin-message" style="display:none; margin-top: 10px;"></div>

          <!-- Mini preview HTML: scegli una lingua e vedi l'email prima di inviare -->
          <div class="admin-newsletter-preview" aria-label="Newsletter-Vorschau (HTML)">
            <div class="admin-newsletter-preview__head">
              <div class="admin-newsletter-preview__title">Newsletter-Vorschau (HTML)</div>
              <div class="admin-newsletter-preview__controls">
                <label for="admin-newsletter-preview-lang" class="small muted">Sprache</label>
                <select id="admin-newsletter-preview-lang" class="admin-newsletter-preview__select" aria-label="Sprache für Vorschau auswählen"></select>
              </div>
            </div>
            <div class="admin-newsletter-preview__meta small muted">
              <span>Betreff:</span>
              <span id="admin-newsletter-preview-subject" class="admin-newsletter-preview__subject"></span>
            </div>
            <div class="admin-newsletter-preview__meta small muted">
              <span>Text (HTML):</span>
            </div>
            <textarea id="admin-newsletter-preview-body" class="admin-newsletter-preview__raw" rows="6" readonly></textarea>
            <iframe id="admin-newsletter-preview-iframe" class="admin-newsletter-preview__iframe" title="Newsletter-Vorschau" sandbox=""></iframe>
          </div>
        </form>
      </div>

    </details>

      <h2 class="admin-section-title">Monatliche Entwicklung (aggregiert)</h2>
      <div class="admin-table-wrapper">
        <table class="admin-table">
          <thead>
            <tr>
              <th>Monat</th>
              <th>Verkäufe</th>
              <th>Netto-Provisionen</th>
              <th>Affiliate-Auszahlungen</th>
              <th>Travirae-Marge</th>
            </tr>
          </thead>
          <tbody id="admin-monthly-tbody">
            <tr><td colspan="5" class="muted small">Keine Daten verfügbar.</td></tr>
          </tbody>
        </table>
      </div>

      <h2 class="admin-section-title">Übersicht pro Affiliate</h2>
      <div class="admin-table-wrapper">
        <table class="admin-table">
          <thead>
            <tr>
              <th>Affiliate ID</th>
              <th>Verkäufe</th>
              <th>Netto-Provisionen</th>
              <th>Affiliate-Auszahlungen</th>
              <th>Travirae-Marge</th>
            </tr>
          </thead>
          <tbody id="admin-affiliates-tbody">
            <tr><td colspan="5" class="muted small">Keine Daten verfügbar.</td></tr>
          </tbody>
        </table>
      </div>

      <h2 class="admin-section-title">Operativ (Klicks und Booking Clicks)</h2>
      <p class="muted small" style="margin-top:-4px;">„Booking Click“ = Klick in den Widgets (Stay22 / Aviasales), der Nutzerinnen und Nutzer von der Website zu einem Partner weiterleitet. Das ist kein bestätigter Verkauf.</p>
      <div class="admin-table-wrapper">
        <table class="admin-table">
          <thead>
            <tr>
              <th>Affiliate ID</th>
              <th>E-Mail</th>
              <th>Link-Klicks</th>
              <th>Booking Clicks gesamt</th>
              <th>Booking Clicks Aviasales</th>
              <th>Booking Clicks Stay22</th>
              <th>Bestätigte Verkäufe (Monat)</th>
              <th>Revenue Share (Monat)</th>
              <th>Monatsverdienst</th>
              <th>Verfügbares Guthaben</th>
              <th>Ausstehende Anfragen</th>
              <th>Letzte Aktivität</th>
            </tr>
          </thead>
          <tbody id="admin-affiliates-kpi-tbody">
            <tr><td colspan="12" class="muted small">Keine Daten verfügbar.</td></tr>
          </tbody>
        </table>
      </div>

      <h2 class="admin-section-title">Auszahlungsanfragen</h2>
      <div class="admin-table-wrapper">
        <table class="admin-table">
          <thead>
            <tr>
              <th>Datum</th>
              <th>Affiliate</th>
              <th>Betrag (USD)</th>
              <th>Methode</th>
              <th>Status</th>
              <th>Details</th>
              <th>Aktionen</th>
            </tr>
          </thead>
          <tbody id="admin-payout-requests-tbody">
            <tr><td colspan="7" class="muted small">Keine Auszahlungsanfragen.</td></tr>
          </tbody>
        </table>
      </div>

</div>

      <div style="margin-top:18px;">
        <h2 class="admin-section-title">Diagramm (Affiliates vs Travirae)</h2>
        <div style="height:260px;">
          <canvas id="admin-earnings-chart" aria-label="Diagramm der Affiliate-Einnahmen vs Travirae"></canvas>
        </div>
      </div>
    </div>

    <div id="admin-message" class="admin-message" aria-live="polite"></div>
  </div>
</div>
</section>
</main>

<footer class="mega-footer">
<div class="container mf-grid">
<div class="mf-brand">
<div class="brand big">
<img alt="Travirae" src="assets/img/common/plane-logo.png" style="height:28px"/>
<span>Travirae</span>
</div>
<p class="muted">Deine Plattform für Reiseinspiration und Hotelbuchung mit interaktiver Karte.</p>
<div class="mf-socials">
  <a class="social social--icon" href="https://www.instagram.com/travirae_official/" aria-label="Instagram" target="_blank" rel="noopener">
    <img src="https://upload.wikimedia.org/wikipedia/commons/e/e7/Instagram_logo_2016.svg" alt="" loading="lazy"/>
  </a>
  <a class="social social--icon" href="https://www.facebook.com/profile.php?id=61573037940606" aria-label="Facebook" target="_blank" rel="noopener">
    <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg" alt="" loading="lazy"/>
  </a>
  <a class="social social--icon" href="https://www.tiktok.com/@travirae?lang=en" aria-label="TikTok" target="_blank" rel="noopener">
    <img src="https://upload.wikimedia.org/wikipedia/commons/a/a6/Tiktok_icon.svg" alt="" loading="lazy"/>
  </a>
  <a class="social social--icon" href="https://www.youtube.com/channel/UCgGtp3qTHUzMPqjpT8EnRbQ" aria-label="YouTube" target="_blank" rel="noopener">
    <img src="https://upload.wikimedia.org/wikipedia/commons/0/09/YouTube_full-color_icon_%282017%29.svg" alt="" loading="lazy"/>
  </a>
</div>
</div>
<nav class="mf-services"><h4>Services</h4><ul>
<li><a href="flights.html">Flüge</a></li>
<li><a href="index.html">Hotels</a></li>
<li><a href="programma-affiliato.html">Partnerprogramm</a></li>
</ul></nav>
<div class="mf-contact">
<h4>Bleib in Kontakt</h4>
<ul class="contact-list">
<li>✉️ info@travirae.com</li>
<li>Abonniere unseren Newsletter</li>
</ul>
<!-- Newsletter (gestita via Supabase Edge Function).
     Usiamo method="get" e un id fisso per evitare submit POST (405) se JS non è caricato. -->
<form id="newsletter-form" class="newsletter-form wide" action="#" method="get">
<input aria-label="E-Mail für Newsletter" name="newsletter_email" placeholder="Deine E-Mail" required="" type="email"/>
<button class="btn" type="submit">Abonnieren</button>
</form>
</div>
</div>
<div class="container mf-bottom muted small">
<div>© <span id="year-copy"></span> Travirae · Alle Rechte vorbehalten</div>
<div class="mf-legal">
<a href="privacy.html">Datenschutz</a> · <a href="termini.html">Bedingungen</a> · <a href="cookie.html">Cookies</a>
</div>
</div>
</footer>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="assets/js/config.js"></script>
<script src="assets/js/supabase-init.js"></script>
<script src="assets/js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="assets/js/admin-affiliati-de.js"></script>
</body>
</html>
