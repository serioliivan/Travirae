const $=(s,ctx=document)=>ctx.querySelector(s);const $$=(s,ctx=document)=>Array.from(ctx.querySelectorAll(s));
const HERO=["https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=1920&q=80","https://images.unsplash.com/photo-1469474968028-56623f02e42e?auto=format&fit=crop&w=1920&q=80","https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1920&q=80","https://images.unsplash.com/photo-1502602898657-3e91760cbb34?auto=format&fit=crop&w=1920&q=80"];
(function(){const b=$("#hero-bg");if(!b)return;HERO.slice(1).forEach(s=>{const i=new Image();i.src=s});let i=0;const set=x=>b.style.backgroundImage=`url('${HERO[x]}')`;set(0);setInterval(()=>{i=(i+1)%HERO.length;set(i)},3e4)})();
fetch("config/partners.json").then(r=>r.json()).then(cfg=>{window.__CFG=cfg;initPage(cfg)});
function initPage(cfg){const p=location.pathname.split("/").pop()||"index.html";$$(".nav a").forEach(a=>{if(a.getAttribute("href")===p)a.setAttribute("aria-current","page")});if(p==="index.html")initHome(cfg);if(p==="flights.html")initFlights(cfg);if(p==="stays.html")initStays(cfg);if(p==="transport.html")initTransport(cfg)}
function buildTpScript(params){const qs=new URLSearchParams(params).toString();const s=document.createElement("script");s.async=true;s.charset="utf-8";s.src="https://tpemd.com/content?"+qs;return s}
function initHome(cfg){const slot=$("#aviasales-slot-home");if(!slot)return;const p={currency:(cfg.TP_CURRENCY||"EUR").toLowerCase(),trs:cfg.TP_TRS,shmarker:cfg.TP_SHMARKER,combine_promos:"101_7873",show_hotels:"true",powered_by:"true",locale:cfg.TP_LOCALE||"en",searchUrl:"www.aviasales.com%2Fsearch",primary_override:"#32a8dd",color_button:"#32a8dd",color_icons:"#32a8dd",dark:"#262626",light:"#FFFFFF",secondary:"#FFFFFF",special:"#C4C4C4",color_focused:"#32a8dd",border_radius:"0",plain:"true",promo_id:cfg.TP_PROMO_ID_FLIGHTS||"7879",campaign_id:cfg.TP_CAMPAIGN_ID_FLIGHTS||"100"};slot.appendChild(buildTpScript(p))}
function initFlights(cfg){const main=$("#aviasales-slot-flights");if(main){const p={currency:(cfg.TP_CURRENCY||"EUR").toLowerCase(),trs:cfg.TP_TRS,shmarker:cfg.TP_SHMARKER,combine_promos:"101_7873",show_hotels:"true",powered_by:"true",locale:cfg.TP_LOCALE||"en",searchUrl:"www.aviasales.com%2Fsearch",primary_override:"#32a8dd",color_button:"#32a8dd",color_icons:"#32a8dd",dark:"#262626",light:"#FFFFFF",secondary:"#FFFFFF",special:"#C4C4C4",color_focused:"#32a8dd",border_radius:"0",plain:"true",promo_id:cfg.TP_PROMO_ID_FLIGHTS||"7879",campaign_id:cfg.TP_CAMPAIGN_ID_FLIGHTS||"100"};main.appendChild(buildTpScript(p))}const cal=$("#aviasales-slot-calendar");if(cal){const p2={currency:(cfg.TP_CURRENCY||"EUR").toLowerCase(),trs:cfg.TP_TRS,shmarker:cfg.TP_SHMARKER,locale:cfg.TP_LOCALE||"en",powered_by:"true",plain:"true",promo_id:cfg.TP_PROMO_ID_FLIGHTS_SECONDARY||"4044",campaign_id:cfg.TP_CAMPAIGN_ID_FLIGHTS||"100"};cal.appendChild(buildTpScript(p2))}}
async function initStays(cfg){const iframe=$("#stay22-widget");const form=$("#stay-form");const aid=cfg.STAY22_AID||"travirae";const campaign=cfg.STAY22_CAMPAIGN_DEFAULT||"homepage";function setMap(lat,lng,checkin,checkout){const u=new URL("https://www.stay22.com/embed/gm");u.searchParams.set("aid",aid);u.searchParams.set("lat",lat);u.searchParams.set("lng",lng);if(checkin)u.searchParams.set("checkin",checkin);if(checkout)u.searchParams.set("checkout",checkout);u.searchParams.append("campaign",campaign);iframe.src=u.toString()}setMap(41.9028,12.4964,new Date().toISOString().slice(0,10),new Date(Date.now()+2*86400000).toISOString().slice(0,10));form&&form.addEventListener("submit",async e=>{e.preventDefault();const city=$("#city").value.trim()||"Rome";const inD=$("#in").value||"";const outD=$("#out").value||"";try{const url=new URL("https://nominatim.openstreetmap.org/search");url.searchParams.set("q",city);url.searchParams.set("format","json");url.searchParams.set("limit","1");const r=await fetch(url.toString(),{headers:{"Accept":"application/json"}});const js=await r.json();const p=js[0];if(p){setMap(p.lat,p.lon,inD,outD)}else{alert("City not found. Try another.")}}catch(err){alert("Network/geocoding error. Try again.")}})}
function initTransport(cfg){const form=$("#t-form");if(!form)return;form.addEventListener("submit",e=>{e.preventDefault();const f=$("#t-from").value.trim();const t=$("#t-to").value.trim();const d=$("#t-date").value;if(!f||!t||!d){alert("Enter origin, destination and date");return}const base=`https://12go.asia/en/travel/${encodeURIComponent(f)}/${encodeURIComponent(t)}?date=${encodeURIComponent(d)}`;const withUtm=base+"&utm_source=travirae&utm_medium=aff&utm_campaign=12go";const click=`https://${cfg.TRAVELPAYOUTS_CLICK_DOMAIN||"c1.travelpayouts.com"}/click?shmarker=${encodeURIComponent(cfg.TP_SHMARKER)}&promo_id=${encodeURIComponent(cfg.TP_PROMO_ID_12GO||"XXXXX")}&source_type=customlink&type=click&custom_url=${encodeURIComponent(withUtm)}`;window.open(click,"_blank","noopener")})}