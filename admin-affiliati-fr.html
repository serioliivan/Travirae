
<!DOCTYPE html>

<html lang="fr">
<head>
<link href="assets/img/common/plane-logo.png" rel="icon" type="image/png"/>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Tableau de bord admin – affiliés | Travirae</title>
<meta content="Tableau de bord admin du programme d’affiliation Travirae : ventes, commissions, versements, demandes et trafic du site." name="description"/>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
<link href="assets/css/style.css" rel="stylesheet"/>
<script id="travirae-lang-router">(function(){
  try{
    var key='travirae_email_lang';
    var lang='';
    try{ lang=String(localStorage.getItem(key)||'').toUpperCase(); }catch(e){}
    if(!lang) return;

    var map={DEU:'de', ENG:'en', FRA:'fr', SPA:'es', RUS:'ru', ARA:'ar', NLD:'nl'};
    var suf=map[lang];
    if(!suf) return;

    var u=new URL(window.location.href);
    var path=u.pathname||'';
    var file=path.split('/').pop()||'';
    var dir=path.slice(0, path.length - file.length);
    if(!file) file='index.html';

    // If already on the correct language page, do nothing
    var reTarget=new RegExp('-'+suf+'\\.html$','i');
    if(reTarget.test(file)) return;

    // Only handle .html pages
    if(!/\\.html$/i.test(file)) return;

    // Strip any other supported suffix, then append the requested one
    var target=file.replace(/-(de|en|fr|es|ru|ar|nl)\\.html$/i,'.html').replace(/\\.html$/i,'-'+suf+'.html');
    u.pathname = dir + target;
    window.location.replace(u.toString());
  }catch(e){}
})();</script>
</head>
<body class="page--affiliate-admin">
<header class="site-header">
<div class="container header-inner">
<a aria-label="Accueil Travirae" class="brand" href="index.html">
<img alt="Travirae" src="assets/img/common/plane-logo.png" style="height:28px"/>
<span>Travirae</span>
</a>
<nav aria-label="Navigation principale" class="main-nav">
<a class="nav-link" href="index.html">Hôtels</a>
<a class="nav-link" href="flights.html">Vols</a>
<a class="nav-link" href="programma-affiliato.html">Programme d’affiliation</a>
</nav>
<button aria-expanded="false" aria-label="Ouvrir le menu" class="nav-toggle"><span></span><span></span><span></span></button>
</div>
</header>
<main>
<section class="section">
<div class="container">
<div class="auth-card">
<div class="admin-header">
<h1 id="admin-title" style="font-size:1.3rem;margin:0 0 4px;">Tableau de bord admin – affiliés</h1>
<p class="muted small" id="admin-subtitle" style="margin:0;">Connecte-toi avec le compte admin pour voir les statistiques globales du programme d’affiliation.</p>
</div>
<div id="admin-view-login">
<form autocomplete="on" class="auth-form" id="admin-login-form">
<div class="form-group">
<label for="admin-email">E-mail admin</label>
<input id="admin-email" name="email" required="" type="email"/>
</div>
<div class="form-group">
<label for="admin-password">Mot de passe</label>
<input id="admin-password" name="password" required="" type="password"/>
</div>
<div class="auth-actions">
<button class="btn" type="submit">Se connecter</button>
</div>
</form>
</div>
<div hidden="" id="admin-view-dashboard">
<div class="admin-stats-grid">
<div class="stat-card">
<div class="stat-label">Ventes valides (mois en cours)</div>
<div class="stat-value" id="admin-total-sales">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Commissions nettes (mois en cours)</div>
<div class="stat-value" id="admin-total-net">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Versements affiliés (mois en cours)</div>
<div class="stat-value" id="admin-total-aff">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Marge Travirae (mois en cours)</div>
<div class="stat-value" id="admin-total-trav">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Ventes directes (sans affilié)</div>
<div class="stat-value" id="admin-direct-sales">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Commissions directes (sans affilié)</div>
<div class="stat-value" id="admin-direct-net">—</div>
</div>
</div>
<h2 class="admin-section-title">Trafic du site (mois en cours)</h2>
<div class="admin-stats-grid">
<div class="stat-card">
<div class="stat-label">Visites totales</div>
<div class="stat-value" id="admin-traffic-visits">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Pages vues totales</div>
<div class="stat-value" id="admin-traffic-pageviews">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Visites via affiliés</div>
<div class="stat-value" id="admin-traffic-visits-affiliate">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Visites directes</div>
<div class="stat-value" id="admin-traffic-visits-direct">—</div>
</div>
</div>
<div class="admin-note" style="margin-top:10px;">
<span class="muted small">Les « visites » sont des sessions uniques (session_id) ; les « pages vues » sont les chargements de page suivis par le site. Les données incluent le trafic avec et sans le paramètre <code>?ref=</code>.</span>
</div>
<h2 class="admin-section-title" style="margin-top:18px;">Clics de réservation du site (mois en cours)</h2>
<div class="admin-stats-grid">
<div class="stat-card">
<div class="stat-label">Clics de réservation totaux</div>
<div class="stat-value" id="admin-bclick-total">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Clics de réservation via affiliés</div>
<div class="stat-value" id="admin-bclick-affiliate">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Clics de réservation directs (sans affilié)</div>
<div class="stat-value" id="admin-bclick-direct">—</div>
</div>
</div>
<div class="admin-note" style="margin-top:10px;">
<span class="muted small">Les « clics de réservation » sont des clics dans les widgets (Stay22 / Aviasales) qui renvoient l’utilisateur hors du site. <strong>Ce ne sont pas</strong> des ventes confirmées.</span>
</div>
<div class="admin-actions">
<button class="btn secondary" id="admin-reload-btn" type="button">Recharger les données</button>
<button class="btn secondary" id="admin-import-aviasales-btn" type="button">Importer les ventes Aviasales</button>
<button class="btn secondary" id="admin-import-stay22-csv-btn" type="button">Importer le CSV Stay22</button>
<input accept=".csv,text/csv" hidden="" id="admin-stay22-csv-input" type="file"/>
<button class="btn secondary" id="admin-refresh-payouts-btn" type="button">Actualiser les versements</button>
<button class="btn secondary" id="admin-2fa-btn" type="button">Sécurité (2FA)</button>
<button class="btn" id="admin-logout-btn" type="button">Se déconnecter</button>
</div>
<details class="admin-accordion" id="admin-newsletter-accordion">
<summary class="admin-section-title admin-accordion-summary">Newsletter</summary>
<div class="admin-stats-grid" style="margin-top: 10px;">
<div class="stat-card">
<div class="stat-label">Abonnés newsletter (total)</div>
<div class="stat-value" id="admin-newsletter-count">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Abonnés (ITA)</div>
<div class="stat-value" id="admin-newsletter-count-ITA">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Abonnés (ENG)</div>
<div class="stat-value" id="admin-newsletter-count-ENG">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Abonnés (ARA)</div>
<div class="stat-value" id="admin-newsletter-count-ARA">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Abonnés (DEU)</div>
<div class="stat-value" id="admin-newsletter-count-DEU">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Abonnés (SPA)</div>
<div class="stat-value" id="admin-newsletter-count-SPA">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Abonnés (RUS)</div>
<div class="stat-value" id="admin-newsletter-count-RUS">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Abonnés (NLD)</div>
<div class="stat-value" id="admin-newsletter-count-NLD">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Abonnés (ZHO)</div>
<div class="stat-value" id="admin-newsletter-count-ZHO">—</div>
</div>
<div class="stat-card">
<div class="stat-label">Abonnés (FRA)</div>
<div class="stat-value" id="admin-newsletter-count-FRA">—</div>
</div>
</div>
<div class="admin-card" style="margin-top: 12px;">
<form class="admin-newsletter-form" id="admin-newsletter-form">
<p class="muted small" style="margin: 0 0 12px;">
            Pour envoyer la newsletter, tu dois remplir <strong>OBJET</strong> et <strong>TEXTE</strong> pour <strong>toutes les langues</strong>.
            Si un seul champ manque, l’envoi sera bloqué.
            La newsletter est envoyée dans la langue enregistrée lors de l’inscription (par ex. si un utilisateur s’inscrit alors que le site est en ENG, il recevra la newsletter en ENG).
          </p>
<div class="admin-newsletter-grid">
<div class="admin-newsletter-lang" data-lang="ITA">
<div class="admin-newsletter-lang-head"><span class="code">ITA</span><span class="name">Italien</span></div>
<label for="newsletter-subject-ITA">Objet</label>
<input autocomplete="off" id="newsletter-subject-ITA" placeholder="Objet (ITA)" type="text"/>
<label for="newsletter-body-ITA">Texte</label>
<textarea id="newsletter-body-ITA" placeholder="Texte de la newsletter (ITA)" rows="6"></textarea>
</div>
<div class="admin-newsletter-lang" data-lang="ENG">
<div class="admin-newsletter-lang-head"><span class="code">ENG</span><span class="name">Anglais</span></div>
<label for="newsletter-subject-ENG">Objet</label>
<input autocomplete="off" id="newsletter-subject-ENG" placeholder="Objet (ENG)" type="text"/>
<label for="newsletter-body-ENG">Texte</label>
<textarea id="newsletter-body-ENG" placeholder="Texte de la newsletter (ENG)" rows="6"></textarea>
</div>
<div class="admin-newsletter-lang" data-lang="FRA">
<div class="admin-newsletter-lang-head"><span class="code">FRA</span><span class="name">Français</span></div>
<label for="newsletter-subject-FRA">Objet</label>
<input autocomplete="off" id="newsletter-subject-FRA" placeholder="Objet (FRA)" type="text"/>
<label for="newsletter-body-FRA">Texte</label>
<textarea id="newsletter-body-FRA" placeholder="Texte de la newsletter (FRA)" rows="6"></textarea>
</div>
<div class="admin-newsletter-lang" data-lang="DEU">
<div class="admin-newsletter-lang-head"><span class="code">DEU</span><span class="name">Allemand</span></div>
<label for="newsletter-subject-DEU">Objet</label>
<input autocomplete="off" id="newsletter-subject-DEU" placeholder="Objet (DEU)" type="text"/>
<label for="newsletter-body-DEU">Texte</label>
<textarea id="newsletter-body-DEU" placeholder="Texte de la newsletter (DEU)" rows="6"></textarea>
</div>
<div class="admin-newsletter-lang" data-lang="SPA">
<div class="admin-newsletter-lang-head"><span class="code">SPA</span><span class="name">Espagnol</span></div>
<label for="newsletter-subject-SPA">Objet</label>
<input autocomplete="off" id="newsletter-subject-SPA" placeholder="Objet (SPA)" type="text"/>
<label for="newsletter-body-SPA">Texte</label>
<textarea id="newsletter-body-SPA" placeholder="Texte de la newsletter (SPA)" rows="6"></textarea>
</div>
<div class="admin-newsletter-lang" data-lang="NLD">
<div class="admin-newsletter-lang-head"><span class="code">NLD</span><span class="name">Néerlandais</span></div>
<label for="newsletter-subject-NLD">Objet</label>
<input autocomplete="off" id="newsletter-subject-NLD" placeholder="Objet (NLD)" type="text"/>
<label for="newsletter-body-NLD">Texte</label>
<textarea id="newsletter-body-NLD" placeholder="Texte de la newsletter (NLD)" rows="6"></textarea>
</div>
<div class="admin-newsletter-lang" data-lang="RUS">
<div class="admin-newsletter-lang-head"><span class="code">RUS</span><span class="name">Russe</span></div>
<label for="newsletter-subject-RUS">Objet</label>
<input autocomplete="off" id="newsletter-subject-RUS" placeholder="Objet (RUS)" type="text"/>
<label for="newsletter-body-RUS">Texte</label>
<textarea id="newsletter-body-RUS" placeholder="Texte de la newsletter (RUS)" rows="6"></textarea>
</div>
<div class="admin-newsletter-lang" data-lang="ARA">
<div class="admin-newsletter-lang-head"><span class="code">ARA</span><span class="name">Arabe</span></div>
<label for="newsletter-subject-ARA">Objet</label>
<input autocomplete="off" id="newsletter-subject-ARA" placeholder="Objet (ARA)" type="text"/>
<label for="newsletter-body-ARA">Texte</label>
<textarea id="newsletter-body-ARA" placeholder="Texte de la newsletter (ARA)" rows="6"></textarea>
</div>
<div class="admin-newsletter-lang" data-lang="ZHO">
<div class="admin-newsletter-lang-head"><span class="code">ZHO</span><span class="name">Chinois</span></div>
<label for="newsletter-subject-ZHO">Objet</label>
<input autocomplete="off" id="newsletter-subject-ZHO" placeholder="Objet (ZHO)" type="text"/>
<label for="newsletter-body-ZHO">Texte</label>
<textarea id="newsletter-body-ZHO" placeholder="Texte de la newsletter (ZHO)" rows="6"></textarea>
</div>
</div>
<div class="admin-actions" style="justify-content:flex-end; margin-top: 12px;">
<button class="btn secondary" id="admin-newsletter-clear-btn" type="button">Effacer les brouillons</button>
<button class="btn btn-primary" id="admin-newsletter-send-btn" type="submit">Envoyer la newsletter</button>
</div>
<div class="admin-message" id="admin-newsletter-status" style="display:none; margin-top: 10px;"></div>
<!-- Mini preview HTML: scegli una lingua e vedi l'email prima di inviare -->
<div aria-label="Aperçu HTML de la newsletter" class="admin-newsletter-preview">
<div class="admin-newsletter-preview__head">
<div class="admin-newsletter-preview__title">Aperçu de la newsletter (HTML)</div>
<div class="admin-newsletter-preview__controls">
<label class="small muted" for="admin-newsletter-preview-lang">Langue</label>
<select aria-label="Sélectionner la langue d’aperçu" class="admin-newsletter-preview__select" id="admin-newsletter-preview-lang"></select>
</div>
</div>
<div class="admin-newsletter-preview__meta small muted">
<span>Objet :</span>
<span class="admin-newsletter-preview__subject" id="admin-newsletter-preview-subject"></span>
</div>
<div class="admin-newsletter-preview__meta small muted">
<span>Texte (HTML) :</span>
</div>
<textarea class="admin-newsletter-preview__raw" id="admin-newsletter-preview-body" readonly="" rows="6"></textarea>
<iframe class="admin-newsletter-preview__iframe" id="admin-newsletter-preview-iframe" sandbox="" title="Aperçu de la newsletter"></iframe>
</div>
</form>
</div>
</details>
<h2 class="admin-section-title">Tendance mensuelle (agrégée)</h2>
<div class="admin-table-wrapper">
<table class="admin-table">
<thead>
<tr>
<th>Mois</th>
<th>Ventes</th>
<th>Commissions nettes</th>
<th>Versements affiliés</th>
<th>Marge Travirae</th>
</tr>
</thead>
<tbody id="admin-monthly-tbody">
<tr><td class="muted small" colspan="5">Aucune donnée disponible.</td></tr>
</tbody>
</table>
</div>
<h2 class="admin-section-title">Résumé par affilié</h2>
<div class="admin-table-wrapper">
<table class="admin-table">
<thead>
<tr>
<th>ID d’affiliation</th>
<th>Ventes</th>
<th>Commissions nettes</th>
<th>Versements affiliés</th>
<th>Marge Travirae</th>
</tr>
</thead>
<tbody id="admin-affiliates-tbody">
<tr><td class="muted small" colspan="5">Aucune donnée disponible.</td></tr>
</tbody>
</table>
</div>
<h2 class="admin-section-title">Opérations (clics et clics de réservation)</h2>
<p class="muted small" style="margin-top:-4px;">« Clic de réservation » = un clic dans un widget (Stay22/Aviasales) qui renvoie l’utilisateur hors du site. Ce n’est pas une vente confirmée.</p>
<div class="admin-table-wrapper">
<table class="admin-table">
<thead>
<tr>
<th>ID d’affiliation</th>
<th>E-mail</th>
<th>Clics sur le lien</th>
<th>Clics de réservation totaux</th>
<th>Clics de réservation Aviasales</th>
<th>Clics de réservation Stay22</th>
<th>Ventes confirmées (mois)</th>
<th>Partage des revenus (mois)</th>
<th>Gains mensuels</th>
<th>Solde disponible</th>
<th>Demandes en attente</th>
<th>Dernière activité</th>
</tr>
</thead>
<tbody id="admin-affiliates-kpi-tbody">
<tr><td class="muted small" colspan="12">Aucune donnée disponible.</td></tr>
</tbody>
</table>
</div>
<h2 class="admin-section-title">Demandes de versement</h2>
<div class="admin-table-wrapper">
<table class="admin-table">
<thead>
<tr>
<th>Date</th>
<th>Affilié</th>
<th>Montant (USD)</th>
<th>Méthode</th>
<th>Statut</th>
<th>Détails</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="admin-payout-requests-tbody">
<tr><td class="muted small" colspan="7">Aucune demande de versement.</td></tr>
</tbody>
</table>
</div>
</div>
<div style="margin-top:18px;">
<h2 class="admin-section-title">Graphique (affiliés vs Travirae)</h2>
<div style="height:260px;">
<canvas aria-label="Graphique des gains affiliés vs Travirae" id="admin-earnings-chart"></canvas>
</div>
</div>
</div>
<div aria-live="polite" class="admin-message" id="admin-message"></div>
</div>
</section>
</main>
<footer class="mega-footer">
<div class="container mf-grid">
<div class="mf-brand">
<div class="brand big">
<img alt="Travirae" src="assets/img/common/plane-logo.png" style="height:28px"/>
<span>Travirae</span>
</div>
<p class="muted">Ta plateforme d’inspiration voyage et de réservation d’hôtels avec carte interactive.</p>
<div class="mf-socials">
<a aria-label="Instagram" class="social social--icon" href="https://www.instagram.com/travirae_official/" rel="noopener" target="_blank">
<img alt="" loading="lazy" src="https://upload.wikimedia.org/wikipedia/commons/e/e7/Instagram_logo_2016.svg"/>
</a>
<a aria-label="Facebook" class="social social--icon" href="https://www.facebook.com/profile.php?id=61573037940606" rel="noopener" target="_blank">
<img alt="" loading="lazy" src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg"/>
</a>
<a aria-label="TikTok" class="social social--icon" href="https://www.tiktok.com/@travirae?lang=en" rel="noopener" target="_blank">
<img alt="" loading="lazy" src="https://upload.wikimedia.org/wikipedia/commons/a/a6/Tiktok_icon.svg"/>
</a>
<a aria-label="YouTube" class="social social--icon" href="https://www.youtube.com/channel/UCgGtp3qTHUzMPqjpT8EnRbQ" rel="noopener" target="_blank">
<img alt="" loading="lazy" src="https://upload.wikimedia.org/wikipedia/commons/0/09/YouTube_full-color_icon_%282017%29.svg"/>
</a>
</div>
</div>
<nav class="mf-services"><h4>Services</h4><ul>
<li><a href="flights.html">Vols</a></li>
<li><a href="index.html">Hôtels</a></li>
<li><a href="programma-affiliato.html">Programme d’affiliation</a></li>
</ul></nav>
<div class="mf-contact">
<h4>Reste en contact</h4>
<ul class="contact-list">
<li>✉️ info@travirae.com</li>
<li>Abonne-toi à notre newsletter</li>
</ul>
<!-- Newsletter (gestita via Supabase Edge Function).
     Usiamo method="get" e un id fisso per evitare submit POST (405) se JS non è caricato. -->
<form action="#" class="newsletter-form wide" id="newsletter-form" method="get">
<input aria-label="E‑mail pour la newsletter" name="newsletter_email" placeholder="Ton e-mail" required="" type="email"/>
<button class="btn" type="submit">S’abonner</button>
</form>
</div>
</div>
<div class="container mf-bottom muted small">
<div>©  Travirae · Tous droits réservés</div>
<div class="mf-legal">
<a href="privacy.html">Confidentialité</a> · <a href="termini.html">Conditions</a> · <a href="cookie.html">Cookies</a>
</div>
</div>
</footer>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="assets/js/config.js"></script>
<script src="assets/js/supabase-init.js"></script>
<script src="assets/js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="assets/js/admin-affiliati-fr.js"></script>
</body>
</html>
